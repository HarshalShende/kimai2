{% extends 'base.html.twig' %}
{% import "invoice/actions.html.twig" as actions %}
{% import "macros/widgets.html.twig" as widgets %}

{% block page_title %}{{ 'admin_invoice_template.title'|trans }}{% endblock %}
{% block page_actions %}{{ actions.invoice_upload('index') }}{% endblock %}

{% block subtitle %}
    {% if is_granted('manage_invoice_template') %}
        {{ widgets.breadcrumb({
            ('admin_invoice_template.title'|trans): path('admin_invoice_template'),
            ('label.invoice_renderer'|trans({}, 'invoice-renderer')): '#'
        }) }}
    {% endif %}
{% endblock %}

{% block main %}
    {% if can_upload and form is not null %}
        {% embed '@theme/embeds/card.html.twig' %}
        {% form_theme form '@theme/layout/form-theme-horizontal.html.twig' %}
            {% block box_title %}
                {{ 'upload'|trans }}
            {% endblock %}
            {% block box_body %}
                {{ form_start(form) }}
                {{ form_row(form.document) }}
                {{ form_end(form) }}
            {% endblock %}
            {% block box_footer %}
                <button type="submit" class="btn btn-primary">{{ 'action.save'|trans }}</button>
            {% endblock %}
        {% endembed %}
    {% elseif upload_error is not null %}
        {{ widgets.callout('warning', upload_error|trans(error_replacer)) }}
    {% endif %}

    {% if documents|length > 0 %}
        {% embed '@theme/embeds/card.html.twig' with {'documents': documents} %}
            {% import "invoice/actions.html.twig" as actions %}
            {% import "macros/widgets.html.twig" as widgets %}
            {% block box_title %}{{ 'label.invoice_renderer'|trans({}, 'invoice-renderer') }}{% endblock %}
            {% block box_attributes %}
                id="invoice_document_list"
            {% endblock %}
            {% block box_body_class %}p-0{% endblock %}
            {% block box_body %}
                <table class="table table-hover dataTable">
                    <thead>
                        <tr>
                            <th>{{ 'file'|trans }}</th>
                            <th>{{ 'updated_at'|trans }}</th>
                            <th>{{ 'label.template'|trans }}</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for config in documents %}
                        {% set document = config.document %}
                        <tr>
                            <td>{{ document.name }}</td>
                            <td>{{ document.lastChange|date }}</td>
                            <td>
                                {% if config.template is not null %}
                                    {{ config.template.name }}
                                {% endif %}
                            </td>
                            <td class="actions">
                                {% if not config.used %}
                                    {{ actions.invoice_document(document, 'index') }}
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            {% endblock %}
        {% endembed %}
    {% endif %}
{% endblock %}
